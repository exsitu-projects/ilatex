\ProvidesPackage{gridlayout}[2020/08/17 iLaTeX]
\RequirePackage{environ}
\RequirePackage{ilatex}


\newlength{\gridlayout@gridwidth}
\newlength{\gridlayout@gridheight}
\newlength{\rowheight}
\newlength{\cellwidth}

\newlength{\gridlayout@savedfboxsep}
\setlength{\gridlayout@savedfboxsep}{\fboxsep}

% The gridlayout environements seems to suffer from the same limitations
% than the itabular environement regarding the usage of the \ilatex command.
% For this reason, the writing of a new mapping, the PDF annotation
% and the counter increment are directly performed inside gridlayout's definition.
% Read the comments about the definition of itabular (in ilatex.sty) for more details.
\NewEnviron{gridlayout}[2]
{%
    \setlength{\fboxsep}{0pt}%
    \setlength{\gridlayout@gridwidth}{#1}%
    \setlength{\gridlayout@gridheight}{#2}%
    \par
    \pdftooltip{{\begin{minipage}[b]{\gridlayout@gridwidth}%
        \BODY%
    \end{minipage}}}{ilatex-code-mapping-id-\CurrentAnnotationValue@ilatex}%
    \stepcounter{Annotation@ilatex}%
    \setlength{\fboxsep}{\gridlayout@savedfboxsep}
    \par
}
{}

\AtBeginEnvironment{gridlayout}{%
    \WriteMapToCurrentLine@ilatex{gridlayout}%
    \let\CurrentAnnotationValue@ilatex\theAnnotation@ilatex%
}

\NewEnviron{row}[1]
{%
    \setlength{\rowheight}{#1\gridlayout@gridheight}%
    \makebox{\begin{minipage}[b]{\gridlayout@gridwidth}%
        \BODY%
    \end{minipage}}%
    \par
}
{}

\NewEnviron{cell}[1]
{%
    \setlength{\cellwidth}{#1\gridlayout@gridwidth}%
    \makebox{\begin{minipage}[b][\rowheight][t]{\cellwidth}%
        \BODY%
    \end{minipage}}%
}
{}


\endinput