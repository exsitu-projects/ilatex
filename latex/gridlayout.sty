\ProvidesPackage{gridlayout}[2020/08/17 iLaTeX]
\RequirePackage{environ}
\RequirePackage{ilatex}


\newlength{\gridlayout@gridwidth}
%\newlength{\gridlayout@rowsep}
\newlength{\gridlayout@rowheight}
%\newlength{\gridlayout@cellsep}
\newlength{\gridlayout@cellwidth}

\newlength{\gridlayout@savedfboxsep}
\setlength{\gridlayout@savedfboxsep}{\fboxsep}

% The gridlayout environements sees to suffer from the same limitations
% than the itabular environement regarding the usage of the \ilatex command.
% For this reason, the writing of a new mapping, the PDF annotation
% and the counter increment are directly performed inside gridlayout's definition.
% Read the comments about the definition of itabular (in ilatex.sty) for more details.
\NewEnviron{gridlayout}[1][\textwidth]
{%
    \setlength{\fboxsep}{0pt}%
    \setlength{\gridlayout@gridwidth}{#1}%
    \par
    \pdftooltip{{\begin{minipage}[b]{\gridlayout@gridwidth}%
        \BODY%
    \end{minipage}}}{ilatex-code-mapping-id-\CurrentAnnotationValue@ilatex}%
    \stepcounter{Annotation@ilatex}%
    \setlength{\fboxsep}{\gridlayout@savedfboxsep}
    \par
}
{}

\AtBeginEnvironment{gridlayout}{%
    \WriteMapToCurrentLine@ilatex{gridlayout}%
    \let\CurrentAnnotationValue@ilatex\theAnnotation@ilatex%
}

\NewEnviron{row}[1]
{%
    \setlength{\gridlayout@rowheight}{#1}%
    \makebox{\begin{minipage}[b]{\textwidth}%
        \BODY%
    \end{minipage}}%
    \par
}
{}

\NewEnviron{cell}[1]
{%
    \setlength{\gridlayout@cellwidth}{#1\textwidth}%
    \makebox{\begin{minipage}[b][\gridlayout@rowheight][t]{\gridlayout@cellwidth}%
        \BODY%
    \end{minipage}}%
}
{}

\newcommand{\cellsep}[1]{%
    \hspace{#1\textwidth}%
}

\newcommand{\rowsep}[1]{\\[\dimexpr#1-\baselineskip]}
% \newcommand{\rowsep}[1]{%
%     \parbox[t][#1][t]{\gridlayout@gridwidth}{}%
% }


\endinput